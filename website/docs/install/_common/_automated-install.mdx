import CodeBlock from '@theme/CodeBlock';

import customField from '@site/src/libs/customField';

import LinksVsForwarders from '@site/src/components/LinksVsForwarders'

{/* ------------------------------------------------------------------------ */}

## Automated install

The easiest (and recommended) way to install { customField('appName') } on { props.label } is by using the **binary xPack**, available as
<a href={ `https://www.npmjs.com/package/@xpack-dev-tools/${ customField('appLcName')}` }><code>@xpack-dev-tools/{ customField('appLcName') }</code></a>
from the [`npmjs.com`](https://www.npmjs.com) registry.

### Prerequisites

The only requirement for an automated install is a recent
[xpm](https://xpack.github.io/xpm/), which is a portable
[Node.js](https://nodejs.org) command line application
that complements [npm](https://docs.npmjs.com)
with several extra features specific to
**C/C++ projects**.

To install **xpm**,
follow the instructions in the
[xpm install](https://xpack.github.io/xpm/install/) page.

If already installed, it is always a good idea to update it to the
latest version with:

```sh
npm install --location=global xpm@latest
```

:::tip

Although not mandated by **xpm**, it is also a good idea to upgrade
**npm** to the latest version, and
**node** to a reasonably recent version (currently **npm** requires
a **node** >=18.17.0).

:::

### Local vs. global installs

To ensure reproducibility, it is essential to use specific versions
of the tools for each project.

Similarly to **npm** being able to install specific versions of the
JavaScript tools into each project,
**xpm** was also designed to install specific versions of the
required binary tools into each project.

Thus, similarly to the JavaScript tools installed by **npm** in
`node_modules/.bin`, **xpm** installs the binary tools in
`xpacks/.bin`.

### The central xPacks store

Given that some binary tools (such as toolchains) can be very large
(hundreds of megabytes or more), it is impractical to maintain multiple
copies of these tools, one for each project.

Instead, **xpm** installs the binary packages into a platform-dependent folder
within the home directory, thereby conserving disk space when these tools are
used across multiple projects.

Then, in order to allow the projects to access the binary tools,
**xpm** adds <LinksVsForwarders isWindows={ props.isWindows }/>
into the projects pointing to the **central xPacks store**.

The outcome is functionally equivalent to installing the tools in each project,
but without the wasted disk space.

:::tip

It is possible to force a local install by passyng `--copy` to `xpm install`.

:::

However, if needed, it is also possible to install packages only globally,
without creating local <LinksVsForwarders isWindows={ props.isWindows }/>
(see below).

### Initialise the project

Upon initial use, ensure that a `package.json` file is present in the
project root folder.

This can be achieved by running `xpm init` in the desired folder
(substitute `my-project` accordingly):

```sh
cd my-project
xpm init
```

### Install locally

The next step is to install the
**{ customField('appLcName') }** package into the project:

<CodeBlock language="sh"> {
`xpm install @xpack-dev-tools/${ customField('appLcName') }@latest --verbose`
}</CodeBlock>

The main result is a set of <LinksVsForwarders isWindows={ props.isWindows }/>:

<CodeBlock language="console"> {
`${ props.isWindows === 'True' ? 'dir xpacks\\.bin' : 'ls -l xpacks/.bin' }`
}</CodeBlock>

The above `xpm install` command will do the following:

* identify the platform specific archive for the latest available version
  of { customField('appName') }, download it in a cache and unpack
  it into a versioned folder
  in the **central xPacks store** (if not already there);
  check the output of the `xpm` command for the actual
  folder used on your platform;
* add <LinksVsForwarders isWindows={ props.isWindows }/>
  into the local `xpacks/.bin` folder, referring to the binaries in the central store;
* add <code>@xpack-dev-tools/{ customField('appLcName') }</code> to `package.json` as a
  development dependency; this associates a specific version of { customField('appName') } with
  the current project (details below).

:::tip

The install location can be configured using the
`XPACKS_STORE_FOLDER` environment variable; for more details please check the
[xpm folders](https://xpack.github.io/xpm/folders/) page.

:::

:::tip

**xpm** unpacks the archive content into a folder
named `.content`. On some platforms
this might be hidden for normal browsing, and seeing it requires
separate options (like `ls -A`) or, in file browsers, to enable
settings like **Show Hidden Files**.

:::

### devDependencies

As mentioned before, **xpm** adds all locally installed binary packages
as development dependencies in the project `package.json` file.

The result looks like this:

<CodeBlock language="json"> {
`  "xpack": {
    "minimumXpmRequired": "0.19.1",
    "dependencies": {},
    "devDependencies": {
      "@xpack-dev-tools/${ customField('appLcName') }": {
        "specifier": "${ customField('upstreamVersion') }-${ customField('xpackSubversion') }.${ customField('npmSubversion') }",
        "local": "link",
        "platforms": "all"
      }
    },
    "properties": {},
    "actions": {},
    "buildConfigurations": {}
  }`
}</CodeBlock>

If the `package.json` is saved in the revision system, the project gets
a hard reference to the specific version of
**xPack { customField('appName') }**.

After cloning the project to a different location, the command `xpm install`
can be used to install all development dependencies.

This is particularly useful for CI/CD environments.


### Install globally

For xPacks aware development environments (like the **Eclipse Embedded C/C++ plug-ins**),
it is also possible to install { customField('appName') } only globally in the **central
xPacks store**, without any local <LinksVsForwarders isWindows={ props.isWindows }/>,
assuming the development environments are capable of handling
the paths themselves.

:::note

Installing packages locally into a project always installs the
packages in the **central xPacks store**; subsequent attempts to
install the package globally will fail with _already installed_.

:::

<CodeBlock language="sh"> {
`xpm install --global @xpack-dev-tools/${ customField('appLcName') }@latest --verbose`
}</CodeBlock>

### Folder hierarchy

After install, the package creates a folder hierarchy like the following
(only the first two depth levels are shown):
