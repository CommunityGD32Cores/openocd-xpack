
import InstallEasy from './_install-easy.md';
import InstallLinuxTree from './_install-linux-tree.mdx';
import UninstallEasy from './_uninstall-easy.md';
import InstallManual from './_install-manual.md';
import InstallManualInfo from './_install-manual-info.mdx';
import CodeBlock from '@theme/CodeBlock';

<InstallEasy/>

<InstallLinuxTree version={props.version} xpack_subversion={props.xpack_subversion} npm_subversion={props.npm_subversion}/>

No other files are installed in any system folders or other locations.

<UninstallEasy/>

### Quick test

To check if the xpm installed OpenOCD starts, use something like:

<CodeBlock language="console"> {
`$ ~/.local/xPacks/@xpack-dev-tools/openocd/${ props.version }-${ props.xpack_subversion }.${ props.npm_subversion }/.content/bin/openocd --version
${ props.version }`
}</CodeBlock>

<InstallManual/>

### Download

The GNU/Linux versions of **xPack OpenOCD**
are packed as `.tar.gz` archives.
Download the latest version named like:

* <code>xpack-openocd-{ props.version }-{ props.xpack_subversion }-linux-x64.tar.gz</code>
* <code>xpack-openocd-{ props.version }-{ props.xpack_subversion }-linux-arm.tar.gz</code>
* <code>xpack-openocd-{ props.version }-{ props.xpack_subversion }-linux-arm64.tar.gz</code>

As the name implies, these are GNU/Linux `tar.gz` archives; they were build on
Ubuntu, but can be executed on most recent GNU/Linux distributions.

:::note

In case you wonder where the suffix comes
from, it is exactly the Node.js `process.platform` and `process.arch`.

:::

### Unpack

To manually install the <b>xPack OpenOCD</b>,
unpack the archive and move it
to <code>~/.local/xPacks/openocd/xpack-openocd-{ props.version }-{ props.xpack_subversion }</code>:

<CodeBlock language="console"> {
`mkdir -p ~/.local/xPacks/openocd
cd ~/.local/xPacks/openocd

tar xvf ~/Downloads/xpack-openocd-${ props.version }-${ props.xpack_subversion }-linux-x64.tar.gz
chmod -R -w xpack-openocd-${ props.version }-${ props.xpack_subversion }`
}</CodeBlock>

<InstallManualInfo/>

### Quick test

To check if the manually installed OpenOCD starts, use something like:

<CodeBlock language="console"> {
`$ ~/.local/xPacks/openocd/xpack-openocd-${ props.version }-${ props.xpack_subversion }/bin/openocd --version
${ props.version }`
}</CodeBlock>

## Drivers

### UDEV

For the JTAG probes implemented as USB devices (actually most of them),
the last installation step on GNU/Linux is to configure the **UDEV**
subsystem. OpenOCD provides an UDEV rules file defining all the
supported IDs; to install it, just copy the file to `/etc/udev/rules.d`
and eventually notify the daemon:

<CodeBlock language="sh"> {
`sudo cp ~/.local/xPacks/@xpack-dev-tools/openocd/${ props.version }-${ props.xpack_subversion }.${ props.npm_subversion }/.content/contrib/60-openocd.rules /etc/udev/rules.d/`
}</CodeBlock>

To make the change effective, reload the rules:

```sh
sudo udevadm control --reload-rules
```

:::tip

If you previously installed the
J-Link binaries, the USB IDs were
already added to UDEV. The above OpenOCD rules file also defines the
J-Link ID. Apparently UDEV does not complain; if you encounter
problems, just comment out the definition in the OpenOCD file.

:::

### USB access rights

On some GNU/Linux distributions, the UDEV definitions are not enough,
or are not effective, and when trying to access the JTAG probe,
an error is issued:

```console
libusb_open failed: LIBUSB_ERROR_ACCESS
```

If this happens, first try to start openocd with `sudo`; if this works,
for regular work you also need to grant your user permission to use the USB.

For example, on Ubuntu you need to issue something like:

```sh
sudo usermod -aG plugdev $USER
```

Then restart and login again.

If you still have problems, check your distribution documentation and
when you have a functional solution post it on the project
[GitHub Discussions](https://github.com/xpack-dev-tools/openocd-xpack/discussions/).
